import{r as d,j as e,c as J,u as K,a as X,f as Z,g as V}from"./index-Crnfew7Q.js";import{c as H,a as Q,P as _,u as W,b as L,d as z,e as Y,f as ee,B as E,A as te,g as se}from"./index-ZFCiGQJF.js";import{u as ne,C as oe,J as re}from"./index-DjKFAowM.js";import{P as ae}from"./index-CRgOu64B.js";const ce=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],A=H("download",ce);const ie=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],B=H("folder",ie);var S="Checkbox",[le]=Q(S),[de,R]=le(S);function ue(s){const{__scopeCheckbox:l,checked:n,children:a,defaultChecked:c,disabled:o,form:h,name:k,onCheckedChange:f,required:g,value:p="on",internal_do_not_use_render:u}=s,[b,C]=W({prop:n,defaultProp:c??!1,onChange:f,caller:S}),[t,r]=d.useState(null),[x,i]=d.useState(null),m=d.useRef(!1),w=t?!!h||!!t.closest("form"):!0,j={checked:b,disabled:o,setChecked:C,control:t,setControl:r,name:k,form:h,value:p,hasConsumerStoppedPropagationRef:m,required:g,defaultChecked:N(c)?!1:c,isFormControl:w,bubbleInput:x,setBubbleInput:i};return e.jsx(de,{scope:l,...j,children:xe(u)?u(j):a})}var D="CheckboxTrigger",M=d.forwardRef(({__scopeCheckbox:s,onKeyDown:l,onClick:n,...a},c)=>{const{control:o,value:h,disabled:k,checked:f,required:g,setControl:p,setChecked:u,hasConsumerStoppedPropagationRef:b,isFormControl:C,bubbleInput:t}=R(D,s),r=L(c,p),x=d.useRef(f);return d.useEffect(()=>{const i=o?.form;if(i){const m=()=>u(x.current);return i.addEventListener("reset",m),()=>i.removeEventListener("reset",m)}},[o,u]),e.jsx(_.button,{type:"button",role:"checkbox","aria-checked":N(f)?"mixed":f,"aria-required":g,"data-state":G(f),"data-disabled":k?"":void 0,disabled:k,value:h,...a,ref:r,onKeyDown:z(l,i=>{i.key==="Enter"&&i.preventDefault()}),onClick:z(n,i=>{u(m=>N(m)?!0:!m),t&&C&&(b.current=i.isPropagationStopped(),b.current||i.stopPropagation())})})});M.displayName=D;var T=d.forwardRef((s,l)=>{const{__scopeCheckbox:n,name:a,checked:c,defaultChecked:o,required:h,disabled:k,value:f,onCheckedChange:g,form:p,...u}=s;return e.jsx(ue,{__scopeCheckbox:n,checked:c,defaultChecked:o,disabled:k,required:h,onCheckedChange:g,name:a,form:p,value:f,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(M,{...u,ref:l,__scopeCheckbox:n}),b&&e.jsx($,{__scopeCheckbox:n})]})})});T.displayName=S;var O="CheckboxIndicator",q=d.forwardRef((s,l)=>{const{__scopeCheckbox:n,forceMount:a,...c}=s,o=R(O,n);return e.jsx(ae,{present:a||N(o.checked)||o.checked===!0,children:e.jsx(_.span,{"data-state":G(o.checked),"data-disabled":o.disabled?"":void 0,...c,ref:l,style:{pointerEvents:"none",...s.style}})})});q.displayName=O;var U="CheckboxBubbleInput",$=d.forwardRef(({__scopeCheckbox:s,...l},n)=>{const{control:a,hasConsumerStoppedPropagationRef:c,checked:o,defaultChecked:h,required:k,disabled:f,name:g,value:p,form:u,bubbleInput:b,setBubbleInput:C}=R(U,s),t=L(n,C),r=ne(o),x=Y(a);d.useEffect(()=>{const m=b;if(!m)return;const w=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(w,"checked").set,y=!c.current;if(r!==o&&v){const P=new Event("click",{bubbles:y});m.indeterminate=N(o),v.call(m,N(o)?!1:o),m.dispatchEvent(P)}},[b,r,o,c]);const i=d.useRef(N(o)?!1:o);return e.jsx(_.input,{type:"checkbox","aria-hidden":!0,defaultChecked:h??i.current,required:k,disabled:f,name:g,value:p,form:u,...l,tabIndex:-1,ref:t,style:{...l.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});$.displayName=U;function xe(s){return typeof s=="function"}function N(s){return s==="indeterminate"}function G(s){return N(s)?"indeterminate":s?"checked":"unchecked"}function F({className:s,...l}){return e.jsx(T,{"data-slot":"checkbox",className:J("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:e.jsx(q,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(oe,{className:"size-3.5"})})})}const be=()=>{const{t:s}=K(),l=X(),n=ee(),[a,c]=d.useState({}),[o,h]=d.useState(!1),k=t=>{c(r=>({...r,[t]:!r[t]}))},f=()=>{const t=n.notes.every(x=>a[x.id]),r={};n.notes.forEach(x=>{r[x.id]=!t}),c(r)},g=()=>n.notes.filter(t=>a[t.id]).length,p=async()=>{try{await n.verifyPermission();const t=await n.fetchNotes(),r={};t.forEach(x=>{r[x.id]=!0}),c(r)}catch(t){console.error("Failed to load folder:",t)}},u=async()=>{try{h(!0);const t=n.notes.filter(y=>a[y.id]);if(t.length===0){h(!1);return}const r=new re,x=await se();for(const y of t){const I=await(await x.getFileHandle(y.id)).getFile();I&&r.file(y.id,I)}const i=await r.generateAsync({type:"blob"}),w=`notes_export_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.zip`,j=URL.createObjectURL(i),v=document.createElement("a");v.href=j,v.download=w,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(j)}finally{h(!1)}},b=()=>l("/settings");d.useEffect(()=>{p()},[]);const C=()=>n.hasPermission?n.notes.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:e.jsx("p",{className:"text-slate-500 text-center",children:s("exportNotes.noNotes")})}):e.jsxs("div",{className:"h-[calc(100vh-11rem)]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(F,{id:"toggle-select",checked:n.notes.every(t=>a[t.id]),onCheckedChange:f}),e.jsx("label",{className:"text-sm font-medium",htmlFor:"toggle-select",children:n.notes.every(t=>a[t.id])?s("exportNotes.deselectAll"):s("exportNotes.selectAll")})]}),e.jsx("div",{className:"space-y-2 mb-20",children:n.notes.map(t=>e.jsxs("div",{className:"bg-card p-5 rounded-md cursor-pointer transition-colors flex flex-col w-full",onClick:()=>k(t.id),children:[e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsx(F,{checked:a[t.id],id:t.id}),e.jsx("span",{className:"font-medium mr-auto",children:t.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Z(t.updatedAt)})]}),t.isEncrypted?e.jsx("p",{className:"text-xs text-muted-foreground mt-1 italic",children:s("exportNotes.encrypted")}):e.jsxs("p",{className:"text-xs text-muted-foreground truncate mt-1",children:[V(t.content).slice(0,100),t.content.length>100?"...":""]})]},t.id))})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:e.jsx("p",{className:"text-slate-500 text-center",children:s("exportNotes.permissionDenied")})});return e.jsxs("div",{className:"container max-w-5xl mx-auto flex flex-col h-full bg-background",children:[e.jsxs("div",{className:"sticky top-0 z-10 border-b px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:b,className:"mr-2",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-medium",children:s("exportNotes.title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.hasPermission||e.jsxs(e.Fragment,{children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:p,className:"hidden sm:flex items-center",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:s("exportNotes.buttons.openFolder")})]}),e.jsx(E,{variant:"outline",size:"icon",onClick:p,className:"sm:hidden",children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsxs(E,{size:"sm",onClick:u,disabled:o||g()===0,className:"hidden sm:flex items-center",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:s("exportNotes.buttons.export")})]}),e.jsx(E,{size:"icon",onClick:u,disabled:o||g()===0,className:"sm:hidden",children:e.jsx(A,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex-1 px-4 py-3 overflow-hidden",children:C()})]})};export{be as default};
