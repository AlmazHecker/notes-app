import{r as u,j as e,c as G,u as J,a as K,f as V,g as X}from"./index-BT7KSkLX.js";import{u as Z,C as Q,J as W}from"./index-rTzI-6d6.js";import{c as A,a as Y,P as S,u as ee,b as B,d as R,e as te,f as se,B as w,A as ne,n as oe}from"./index-BMskUb3t.js";import{P as re}from"./index-C1hO7JdG.js";const ce=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],P=A("download",ce);const ae=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],I=A("folder",ae);var E="Checkbox",[ie]=Y(E),[le,_]=ie(E);function de(s){const{__scopeCheckbox:d,checked:n,children:r,defaultChecked:a,disabled:o,form:m,name:b,onCheckedChange:x,required:k,value:N="on",internal_do_not_use_render:h}=s,[f,t]=ee({prop:n,defaultProp:a??!1,onChange:x,caller:E}),[c,p]=u.useState(null),[j,i]=u.useState(null),l=u.useRef(!1),g=c?!!m||!!c.closest("form"):!0,v={checked:f,disabled:o,setChecked:t,control:c,setControl:p,name:b,form:m,value:N,hasConsumerStoppedPropagationRef:l,required:k,defaultChecked:C(a)?!1:a,isFormControl:g,bubbleInput:j,setBubbleInput:i};return e.jsx(le,{scope:d,...v,children:ue(h)?h(v):r})}var L="CheckboxTrigger",F=u.forwardRef(({__scopeCheckbox:s,onKeyDown:d,onClick:n,...r},a)=>{const{control:o,value:m,disabled:b,checked:x,required:k,setControl:N,setChecked:h,hasConsumerStoppedPropagationRef:f,isFormControl:t,bubbleInput:c}=_(L,s),p=B(a,N),j=u.useRef(x);return u.useEffect(()=>{const i=o?.form;if(i){const l=()=>h(j.current);return i.addEventListener("reset",l),()=>i.removeEventListener("reset",l)}},[o,h]),e.jsx(S.button,{type:"button",role:"checkbox","aria-checked":C(x)?"mixed":x,"aria-required":k,"data-state":U(x),"data-disabled":b?"":void 0,disabled:b,value:m,...r,ref:p,onKeyDown:R(d,i=>{i.key==="Enter"&&i.preventDefault()}),onClick:R(n,i=>{h(l=>C(l)?!0:!l),c&&t&&(f.current=i.isPropagationStopped(),f.current||i.stopPropagation())})})});F.displayName=L;var M=u.forwardRef((s,d)=>{const{__scopeCheckbox:n,name:r,checked:a,defaultChecked:o,required:m,disabled:b,value:x,onCheckedChange:k,form:N,...h}=s;return e.jsx(de,{__scopeCheckbox:n,checked:a,defaultChecked:o,disabled:b,required:m,onCheckedChange:k,name:r,form:N,value:x,internal_do_not_use_render:({isFormControl:f})=>e.jsxs(e.Fragment,{children:[e.jsx(F,{...h,ref:d,__scopeCheckbox:n}),f&&e.jsx(H,{__scopeCheckbox:n})]})})});M.displayName=E;var D="CheckboxIndicator",T=u.forwardRef((s,d)=>{const{__scopeCheckbox:n,forceMount:r,...a}=s,o=_(D,n);return e.jsx(re,{present:r||C(o.checked)||o.checked===!0,children:e.jsx(S.span,{"data-state":U(o.checked),"data-disabled":o.disabled?"":void 0,...a,ref:d,style:{pointerEvents:"none",...s.style}})})});T.displayName=D;var O="CheckboxBubbleInput",H=u.forwardRef(({__scopeCheckbox:s,...d},n)=>{const{control:r,hasConsumerStoppedPropagationRef:a,checked:o,defaultChecked:m,required:b,disabled:x,name:k,value:N,form:h,bubbleInput:f,setBubbleInput:t}=_(O,s),c=B(n,t),p=Z(o),j=te(r);u.useEffect(()=>{const l=f;if(!l)return;const g=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(g,"checked").set,q=!a.current;if(p!==o&&y){const $=new Event("click",{bubbles:q});l.indeterminate=C(o),y.call(l,C(o)?!1:o),l.dispatchEvent($)}},[f,p,o,a]);const i=u.useRef(C(o)?!1:o);return e.jsx(S.input,{type:"checkbox","aria-hidden":!0,defaultChecked:m??i.current,required:b,disabled:x,name:k,value:N,form:h,...d,tabIndex:-1,ref:c,style:{...d.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});H.displayName=O;function ue(s){return typeof s=="function"}function C(s){return s==="indeterminate"}function U(s){return C(s)?"indeterminate":s?"checked":"unchecked"}function z({className:s,...d}){return e.jsx(M,{"data-slot":"checkbox",className:G("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...d,children:e.jsx(T,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Q,{className:"size-3.5"})})})}const fe=()=>{const{t:s}=J(),d=K(),n=se(),[r,a]=u.useState({}),[o,m]=u.useState(!1),b=t=>{a(c=>({...c,[t]:!c[t]}))},x=()=>{const t=n.notes.every(p=>r[p.id]),c={};n.notes.forEach(p=>{c[p.id]=!t}),a(c)},k=()=>n.notes.filter(t=>r[t.id]).length,N=async()=>{try{m(!0);const t=n.notes.filter(v=>r[v.id]);if(t.length===0){m(!1);return}const c=new W;for(const v of t){const y=await oe.getFileByName(v.id);y&&c.file(v.id,y)}const p=await c.generateAsync({type:"blob"}),i=`notes_export_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.zip`,l=URL.createObjectURL(p),g=document.createElement("a");g.href=l,g.download=i,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(l)}finally{m(!1)}},h=()=>d("/settings");u.useEffect(()=>{n.getNotes()},[]);const f=()=>n.hasPermission?n.notes.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:e.jsx("p",{className:"text-slate-500 text-center",children:s("exportNotes.noNotes")})}):e.jsxs("div",{className:"h-[calc(100vh-11rem)]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(z,{id:"toggle-select",checked:n.notes.every(t=>r[t.id]),onCheckedChange:x}),e.jsx("label",{className:"text-sm font-medium",htmlFor:"toggle-select",children:n.notes.every(t=>r[t.id])?s("exportNotes.deselectAll"):s("exportNotes.selectAll")})]}),e.jsx("div",{className:"space-y-2 mb-20",children:n.notes.map(t=>e.jsxs("div",{className:"bg-card p-5 rounded-md cursor-pointer transition-colors flex flex-col w-full",onClick:()=>b(t.id),children:[e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsx(z,{checked:r[t.id],id:t.id}),e.jsx("span",{className:"font-medium mr-auto",children:t.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:V(t.updatedAt)})]}),t.isEncrypted?e.jsx("p",{className:"text-xs text-muted-foreground mt-1 italic",children:s("exportNotes.encrypted")}):e.jsxs("p",{className:"text-xs text-muted-foreground truncate mt-1",children:[X(t.content).slice(0,100),t.content.length>100?"...":""]})]},t.id))})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:e.jsx("p",{className:"text-slate-500 text-center",children:s("exportNotes.permissionDenied")})});return e.jsxs("div",{className:"container max-w-5xl mx-auto flex flex-col h-full bg-background",children:[e.jsxs("div",{className:"sticky top-0 z-10 border-b px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:h,className:"mr-2",children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-medium",children:s("exportNotes.title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.hasPermission||e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:n.getNotes,className:"hidden sm:flex items-center",children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:s("exportNotes.buttons.openFolder")})]}),e.jsx(w,{variant:"outline",size:"icon",onClick:n.getNotes,className:"sm:hidden",children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs(w,{size:"sm",onClick:N,disabled:o||k()===0,className:"hidden sm:flex items-center",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:s("exportNotes.buttons.export")})]}),e.jsx(w,{size:"icon",onClick:N,disabled:o||k()===0,className:"sm:hidden",children:e.jsx(P,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex-1 px-4 py-3 overflow-hidden",children:f()})]})};export{fe as default};
