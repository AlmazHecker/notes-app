import{r as u,j as e,c as G,u as J,a as K,f as V,g as X}from"./index-CLSb2bgT.js";import{u as Z,C as Q,J as W}from"./index-D11Z5M2Q.js";import{c as B,a as Y,P as _,u as ee,b as L,d as P,e as te,f as se,B as w,A as ne,n as oe}from"./index-BEJK8O4Q.js";import{P as re}from"./index-UMH85uXE.js";const ce=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],I=B("download",ce);const ae=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],z=B("folder",ae);var S="Checkbox",[ie]=Y(S),[le,R]=ie(S);function de(s){const{__scopeCheckbox:i,checked:n,children:c,defaultChecked:a,disabled:o,form:x,name:k,onCheckedChange:p,required:N,value:f="on",internal_do_not_use_render:m}=s,[b,C]=ee({prop:n,defaultProp:a??!1,onChange:p,caller:S}),[t,r]=u.useState(null),[h,l]=u.useState(null),d=u.useRef(!1),y=t?!!x||!!t.closest("form"):!0,g={checked:b,disabled:o,setChecked:C,control:t,setControl:r,name:k,form:x,value:f,hasConsumerStoppedPropagationRef:d,required:N,defaultChecked:v(a)?!1:a,isFormControl:y,bubbleInput:h,setBubbleInput:l};return e.jsx(le,{scope:i,...g,children:ue(m)?m(g):c})}var F="CheckboxTrigger",M=u.forwardRef(({__scopeCheckbox:s,onKeyDown:i,onClick:n,...c},a)=>{const{control:o,value:x,disabled:k,checked:p,required:N,setControl:f,setChecked:m,hasConsumerStoppedPropagationRef:b,isFormControl:C,bubbleInput:t}=R(F,s),r=L(a,f),h=u.useRef(p);return u.useEffect(()=>{const l=o?.form;if(l){const d=()=>m(h.current);return l.addEventListener("reset",d),()=>l.removeEventListener("reset",d)}},[o,m]),e.jsx(_.button,{type:"button",role:"checkbox","aria-checked":v(p)?"mixed":p,"aria-required":N,"data-state":q(p),"data-disabled":k?"":void 0,disabled:k,value:x,...c,ref:r,onKeyDown:P(i,l=>{l.key==="Enter"&&l.preventDefault()}),onClick:P(n,l=>{m(d=>v(d)?!0:!d),t&&C&&(b.current=l.isPropagationStopped(),b.current||l.stopPropagation())})})});M.displayName=F;var D=u.forwardRef((s,i)=>{const{__scopeCheckbox:n,name:c,checked:a,defaultChecked:o,required:x,disabled:k,value:p,onCheckedChange:N,form:f,...m}=s;return e.jsx(de,{__scopeCheckbox:n,checked:a,defaultChecked:o,disabled:k,required:x,onCheckedChange:N,name:c,form:f,value:p,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(M,{...m,ref:i,__scopeCheckbox:n}),b&&e.jsx(U,{__scopeCheckbox:n})]})})});D.displayName=S;var T="CheckboxIndicator",O=u.forwardRef((s,i)=>{const{__scopeCheckbox:n,forceMount:c,...a}=s,o=R(T,n);return e.jsx(re,{present:c||v(o.checked)||o.checked===!0,children:e.jsx(_.span,{"data-state":q(o.checked),"data-disabled":o.disabled?"":void 0,...a,ref:i,style:{pointerEvents:"none",...s.style}})})});O.displayName=T;var H="CheckboxBubbleInput",U=u.forwardRef(({__scopeCheckbox:s,...i},n)=>{const{control:c,hasConsumerStoppedPropagationRef:a,checked:o,defaultChecked:x,required:k,disabled:p,name:N,value:f,form:m,bubbleInput:b,setBubbleInput:C}=R(H,s),t=L(n,C),r=Z(o),h=te(c);u.useEffect(()=>{const d=b;if(!d)return;const y=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(y,"checked").set,E=!a.current;if(r!==o&&j){const $=new Event("click",{bubbles:E});d.indeterminate=v(o),j.call(d,v(o)?!1:o),d.dispatchEvent($)}},[b,r,o,a]);const l=u.useRef(v(o)?!1:o);return e.jsx(_.input,{type:"checkbox","aria-hidden":!0,defaultChecked:x??l.current,required:k,disabled:p,name:N,value:f,form:m,...i,tabIndex:-1,ref:t,style:{...i.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});U.displayName=H;function ue(s){return typeof s=="function"}function v(s){return s==="indeterminate"}function q(s){return v(s)?"indeterminate":s?"checked":"unchecked"}function A({className:s,...i}){return e.jsx(D,{"data-slot":"checkbox",className:G("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...i,children:e.jsx(O,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Q,{className:"size-3.5"})})})}const fe=()=>{const{t:s}=J(),i=K(),n=se(),[c,a]=u.useState({}),[o,x]=u.useState(!1),k=t=>{a(r=>({...r,[t]:!r[t]}))},p=()=>{const t=n.notes.every(h=>c[h.id]),r={};n.notes.forEach(h=>{r[h.id]=!t}),a(r)},N=()=>n.notes.filter(t=>c[t.id]).length,f=async()=>{try{const t=await n.getNotes(),r={};t.forEach(h=>{r[h.id]=!0}),a(r)}catch(t){console.error("Failed to load folder:",t)}},m=async()=>{try{x(!0);const t=n.notes.filter(j=>c[j.id]);if(t.length===0){x(!1);return}const r=new W;for(const j of t){const E=await oe.getFileByName(j.id);E&&r.file(j.id,E)}const h=await r.generateAsync({type:"blob"}),d=`notes_export_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.zip`,y=URL.createObjectURL(h),g=document.createElement("a");g.href=y,g.download=d,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(y)}finally{x(!1)}},b=()=>i("/settings");u.useEffect(()=>{f()},[]);const C=()=>n.hasPermission?n.notes.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:e.jsx("p",{className:"text-slate-500 text-center",children:s("exportNotes.noNotes")})}):e.jsxs("div",{className:"h-[calc(100vh-11rem)]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(A,{id:"toggle-select",checked:n.notes.every(t=>c[t.id]),onCheckedChange:p}),e.jsx("label",{className:"text-sm font-medium",htmlFor:"toggle-select",children:n.notes.every(t=>c[t.id])?s("exportNotes.deselectAll"):s("exportNotes.selectAll")})]}),e.jsx("div",{className:"space-y-2 mb-20",children:n.notes.map(t=>e.jsxs("div",{className:"bg-card p-5 rounded-md cursor-pointer transition-colors flex flex-col w-full",onClick:()=>k(t.id),children:[e.jsxs("div",{className:"flex justify-between items-center gap-3",children:[e.jsx(A,{checked:c[t.id],id:t.id}),e.jsx("span",{className:"font-medium mr-auto",children:t.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:V(t.updatedAt)})]}),t.isEncrypted?e.jsx("p",{className:"text-xs text-muted-foreground mt-1 italic",children:s("exportNotes.encrypted")}):e.jsxs("p",{className:"text-xs text-muted-foreground truncate mt-1",children:[X(t.content).slice(0,100),t.content.length>100?"...":""]})]},t.id))})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:e.jsx("p",{className:"text-slate-500 text-center",children:s("exportNotes.permissionDenied")})});return e.jsxs("div",{className:"container max-w-5xl mx-auto flex flex-col h-full bg-background",children:[e.jsxs("div",{className:"sticky top-0 z-10 border-b px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:b,className:"mr-2",children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-medium",children:s("exportNotes.title")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.hasPermission||e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:f,className:"hidden sm:flex items-center",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:s("exportNotes.buttons.openFolder")})]}),e.jsx(w,{variant:"outline",size:"icon",onClick:f,className:"sm:hidden",children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsxs(w,{size:"sm",onClick:m,disabled:o||N()===0,className:"hidden sm:flex items-center",children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:s("exportNotes.buttons.export")})]}),e.jsx(w,{size:"icon",onClick:m,disabled:o||N()===0,className:"sm:hidden",children:e.jsx(I,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex-1 px-4 py-3 overflow-hidden",children:C()})]})};export{fe as default};
