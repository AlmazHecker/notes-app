import{r as a,R as W,j as s,c as q,u as K,a as J,f as V,g as X}from"./index-BnhIAaU_.js";import{c as L,u as A,a as P,b as Z,d as G,e as O,f as Q,g as Y,B as j,A as ee,h as te}from"./index-CtfVUYf5.js";import{u as ne,C as se,J as oe}from"./index-DYzEogEh.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],_=L("download",re);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],T=L("folder",ie);var ae=W[" useInsertionEffect ".trim().toString()]||A;function ce({prop:e,defaultProp:n,onChange:t=()=>{},caller:o}){const[c,i,m]=le({defaultProp:n,onChange:t}),l=e!==void 0,x=l?e:c;{const f=a.useRef(e!==void 0);a.useEffect(()=>{const h=f.current;h!==l&&console.warn(`${o} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=l},[l,o])}const d=a.useCallback(f=>{var h;if(l){const u=de(f)?f(e):f;u!==e&&((h=m.current)==null||h.call(m,u))}else i(f)},[l,e,i,m]);return[x,d]}function le({defaultProp:e,onChange:n}){const[t,o]=a.useState(e),c=a.useRef(t),i=a.useRef(n);return ae(()=>{i.current=n},[n]),a.useEffect(()=>{var m;c.current!==t&&((m=i.current)==null||m.call(i,t),c.current=t)},[t,c]),[t,o,i]}function de(e){return typeof e=="function"}function ue(e,n){return a.useReducer((t,o)=>n[t][o]??t,e)}var D=e=>{const{present:n,children:t}=e,o=fe(n),c=typeof t=="function"?t({present:o.isPresent}):a.Children.only(t),i=P(o.ref,me(c));return typeof t=="function"||o.isPresent?a.cloneElement(c,{ref:i}):null};D.displayName="Presence";function fe(e){const[n,t]=a.useState(),o=a.useRef(null),c=a.useRef(e),i=a.useRef("none"),m=e?"mounted":"unmounted",[l,x]=ue(m,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return a.useEffect(()=>{const d=E(o.current);i.current=l==="mounted"?d:"none"},[l]),A(()=>{const d=o.current,f=c.current;if(f!==e){const u=i.current,N=E(d);e?x("MOUNT"):N==="none"||(d==null?void 0:d.display)==="none"?x("UNMOUNT"):x(f&&u!==N?"ANIMATION_OUT":"UNMOUNT"),c.current=e}},[e,x]),A(()=>{if(n){let d;const f=n.ownerDocument.defaultView??window,h=N=>{const p=E(o.current).includes(N.animationName);if(N.target===n&&p&&(x("ANIMATION_END"),!c.current)){const v=n.style.animationFillMode;n.style.animationFillMode="forwards",d=f.setTimeout(()=>{n.style.animationFillMode==="forwards"&&(n.style.animationFillMode=v)})}},u=N=>{N.target===n&&(i.current=E(o.current))};return n.addEventListener("animationstart",u),n.addEventListener("animationcancel",h),n.addEventListener("animationend",h),()=>{f.clearTimeout(d),n.removeEventListener("animationstart",u),n.removeEventListener("animationcancel",h),n.removeEventListener("animationend",h)}}else x("ANIMATION_END")},[n,x]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:a.useCallback(d=>{o.current=d?getComputedStyle(d):null,t(d)},[])}}function E(e){return(e==null?void 0:e.animationName)||"none"}function me(e){var o,c;let n=(o=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:o.get,t=n&&"isReactWarning"in n&&n.isReactWarning;return t?e.ref:(n=(c=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:c.get,t=n&&"isReactWarning"in n&&n.isReactWarning,t?e.props.ref:e.props.ref||e.ref)}var pe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],I=pe.reduce((e,n)=>{const t=Z(`Primitive.${n}`),o=a.forwardRef((c,i)=>{const{asChild:m,...l}=c,x=m?t:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),s.jsx(x,{...l,ref:i})});return o.displayName=`Primitive.${n}`,{...e,[n]:o}},{}),S="Checkbox",[xe,we]=G(S),[he,Ne]=xe(S),F=a.forwardRef((e,n)=>{const{__scopeCheckbox:t,name:o,checked:c,defaultChecked:i,required:m,disabled:l,value:x="on",onCheckedChange:d,form:f,...h}=e,[u,N]=a.useState(null),r=P(n,g=>N(g)),p=a.useRef(!1),v=u?f||!!u.closest("form"):!0,[y,C]=ce({prop:c,defaultProp:i??!1,onChange:d,caller:S}),R=a.useRef(y);return a.useEffect(()=>{const g=u==null?void 0:u.form;if(g){const b=()=>C(R.current);return g.addEventListener("reset",b),()=>g.removeEventListener("reset",b)}},[u,C]),s.jsxs(he,{scope:t,state:y,disabled:l,children:[s.jsx(I.button,{type:"button",role:"checkbox","aria-checked":k(y)?"mixed":y,"aria-required":m,"data-state":$(y),"data-disabled":l?"":void 0,disabled:l,value:x,...h,ref:r,onKeyDown:O(e.onKeyDown,g=>{g.key==="Enter"&&g.preventDefault()}),onClick:O(e.onClick,g=>{C(b=>k(b)?!0:!b),v&&(p.current=g.isPropagationStopped(),p.current||g.stopPropagation())})}),v&&s.jsx(H,{control:u,bubbles:!p.current,name:o,value:x,checked:y,required:m,disabled:l,form:f,style:{transform:"translateX(-100%)"},defaultChecked:k(i)?!1:i})]})});F.displayName=S;var z="CheckboxIndicator",B=a.forwardRef((e,n)=>{const{__scopeCheckbox:t,forceMount:o,...c}=e,i=Ne(z,t);return s.jsx(D,{present:o||k(i.state)||i.state===!0,children:s.jsx(I.span,{"data-state":$(i.state),"data-disabled":i.disabled?"":void 0,...c,ref:n,style:{pointerEvents:"none",...e.style}})})});B.displayName=z;var ve="CheckboxBubbleInput",H=a.forwardRef(({__scopeCheckbox:e,control:n,checked:t,bubbles:o=!0,defaultChecked:c,...i},m)=>{const l=a.useRef(null),x=P(l,m),d=ne(t),f=Q(n);a.useEffect(()=>{const u=l.current;if(!u)return;const N=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(N,"checked").set;if(d!==t&&p){const v=new Event("click",{bubbles:o});u.indeterminate=k(t),p.call(u,k(t)?!1:t),u.dispatchEvent(v)}},[d,t,o]);const h=a.useRef(k(t)?!1:t);return s.jsx(I.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??h.current,...i,tabIndex:-1,ref:x,style:{...i.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});H.displayName=ve;function k(e){return e==="indeterminate"}function $(e){return k(e)?"indeterminate":e?"checked":"unchecked"}var ge=F,be=B;function U({className:e,...n}){return s.jsx(ge,{"data-slot":"checkbox",className:q("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...n,children:s.jsx(be,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:s.jsx(se,{className:"size-3.5"})})})}const Ee=()=>{const{t:e}=K(),n=J(),t=Y(),[o,c]=a.useState({}),[i,m]=a.useState(!1),l=r=>{c(p=>({...p,[r]:!p[r]}))},x=()=>{const r=t.notes.every(v=>o[v.id]),p={};t.notes.forEach(v=>{p[v.id]=!r}),c(p)},d=()=>t.notes.filter(r=>o[r.id]).length,f=async()=>{try{await t.verifyPermission();const r=await t.fetchNotes(),p={};r.forEach(v=>{p[v.id]=!0}),c(p)}catch(r){console.error("Failed to load folder:",r)}},h=async()=>{try{m(!0);const r=t.notes.filter(w=>o[w.id]);if(r.length===0){m(!1);return}const p=new oe,v=await te();for(const w of r){const M=await(await v.getFileHandle(w.id)).getFile();M&&p.file(w.id,M)}const y=await p.generateAsync({type:"blob"}),R=`notes_export_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.zip`,g=URL.createObjectURL(y),b=document.createElement("a");b.href=g,b.download=R,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(g)}finally{m(!1)}},u=()=>n("/settings");a.useEffect(()=>{f()},[]);const N=()=>t.hasPermission?t.notes.length===0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:s.jsx("p",{className:"text-slate-500 text-center",children:e("exportNotes.noNotes")})}):s.jsxs("div",{className:"h-[calc(100vh-11rem)]",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx(U,{id:"toggle-select",checked:t.notes.every(r=>o[r.id]),onCheckedChange:x}),s.jsx("label",{className:"text-sm font-medium",htmlFor:"toggle-select",children:t.notes.every(r=>o[r.id])?e("exportNotes.deselectAll"):e("exportNotes.selectAll")})]}),s.jsx("div",{className:"space-y-2 mb-20",children:t.notes.map(r=>s.jsxs("div",{className:"bg-card p-5 rounded-md cursor-pointer transition-colors flex flex-col w-full",onClick:()=>l(r.id),children:[s.jsxs("div",{className:"flex justify-between items-center gap-3",children:[s.jsx(U,{checked:o[r.id],id:r.id}),s.jsx("span",{className:"font-medium mr-auto",children:r.label}),s.jsx("span",{className:"text-xs text-muted-foreground",children:V(r.updatedAt)})]}),r.isEncrypted||s.jsxs("p",{className:"text-xs text-muted-foreground truncate mt-1",children:[X(r.content),r.content.length>100?"...":""]}),r.isEncrypted&&s.jsx("p",{className:"text-xs text-muted-foreground mt-1 italic",children:e("exportNotes.encrypted")})]},r.id))})]}):s.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:s.jsx("p",{className:"text-slate-500 text-center",children:e("exportNotes.permissionDenied")})});return s.jsxs("div",{className:"container max-w-5xl mx-auto flex flex-col h-full bg-background",children:[s.jsxs("div",{className:"sticky top-0 z-10 border-b px-4 py-3 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(j,{variant:"ghost",size:"icon",onClick:u,className:"mr-2",children:s.jsx(ee,{className:"h-5 w-5"})}),s.jsx("h1",{className:"text-lg font-medium",children:e("exportNotes.title")})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[t.hasPermission||s.jsxs(s.Fragment,{children:[s.jsxs(j,{variant:"outline",size:"sm",onClick:f,className:"hidden sm:flex items-center",children:[s.jsx(T,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:e("exportNotes.buttons.openFolder")})]}),s.jsx(j,{variant:"outline",size:"icon",onClick:f,className:"sm:hidden",children:s.jsx(T,{className:"h-4 w-4"})})]}),s.jsxs(j,{size:"sm",onClick:h,disabled:i||d()===0,className:"hidden sm:flex items-center",children:[s.jsx(_,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:e("exportNotes.buttons.export")})]}),s.jsx(j,{size:"icon",onClick:h,disabled:i||d()===0,className:"sm:hidden",children:s.jsx(_,{className:"h-4 w-4"})})]})]}),s.jsx("div",{className:"flex-1 px-4 py-3 overflow-hidden",children:N()})]})};export{Ee as default};
