import{r as a,R as V,j as n,c as X,u as Z,a as G,f as Q,g as Y}from"./index-DwHELXD2.js";import{c as z,u as A,a as I,b as ee,d as te,e as T,f as ne,g as se,B as E,A as oe,h as U,v as re}from"./index-BqIZPfNi.js";import{u as ie,C as ae,J as ce}from"./index-Yn_vlekS.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],L=z("download",le);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],D=z("folder",de);var ue=V[" useInsertionEffect ".trim().toString()]||A;function fe({prop:e,defaultProp:t,onChange:s=()=>{},caller:i}){const[r,c,d]=me({defaultProp:t,onChange:s}),l=e!==void 0,p=l?e:r;{const m=a.useRef(e!==void 0);a.useEffect(()=>{const h=m.current;h!==l&&console.warn(`${i} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),m.current=l},[l,i])}const u=a.useCallback(m=>{var h;if(l){const f=pe(m)?m(e):m;f!==e&&((h=d.current)==null||h.call(d,f))}else c(m)},[l,e,c,d]);return[p,u]}function me({defaultProp:e,onChange:t}){const[s,i]=a.useState(e),r=a.useRef(s),c=a.useRef(t);return ue(()=>{c.current=t},[t]),a.useEffect(()=>{var d;r.current!==s&&((d=c.current)==null||d.call(c,s),r.current=s)},[s,r]),[s,i,c]}function pe(e){return typeof e=="function"}function he(e,t){return a.useReducer((s,i)=>t[s][i]??s,e)}var H=e=>{const{present:t,children:s}=e,i=xe(t),r=typeof s=="function"?s({present:i.isPresent}):a.Children.only(s),c=I(i.ref,Ne(r));return typeof s=="function"||i.isPresent?a.cloneElement(r,{ref:c}):null};H.displayName="Presence";function xe(e){const[t,s]=a.useState(),i=a.useRef(null),r=a.useRef(e),c=a.useRef("none"),d=e?"mounted":"unmounted",[l,p]=he(d,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return a.useEffect(()=>{const u=R(i.current);c.current=l==="mounted"?u:"none"},[l]),A(()=>{const u=i.current,m=r.current;if(m!==e){const f=c.current,x=R(u);e?p("MOUNT"):x==="none"||(u==null?void 0:u.display)==="none"?p("UNMOUNT"):p(m&&f!==x?"ANIMATION_OUT":"UNMOUNT"),r.current=e}},[e,p]),A(()=>{if(t){let u;const m=t.ownerDocument.defaultView??window,h=x=>{const g=R(i.current).includes(x.animationName);if(x.target===t&&g&&(p("ANIMATION_END"),!r.current)){const y=t.style.animationFillMode;t.style.animationFillMode="forwards",u=m.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=y)})}},f=x=>{x.target===t&&(c.current=R(i.current))};return t.addEventListener("animationstart",f),t.addEventListener("animationcancel",h),t.addEventListener("animationend",h),()=>{m.clearTimeout(u),t.removeEventListener("animationstart",f),t.removeEventListener("animationcancel",h),t.removeEventListener("animationend",h)}}else p("ANIMATION_END")},[t,p]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:a.useCallback(u=>{i.current=u?getComputedStyle(u):null,s(u)},[])}}function R(e){return(e==null?void 0:e.animationName)||"none"}function Ne(e){var i,r;let t=(i=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:i.get,s=t&&"isReactWarning"in t&&t.isReactWarning;return s?e.ref:(t=(r=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:r.get,s=t&&"isReactWarning"in t&&t.isReactWarning,s?e.props.ref:e.props.ref||e.ref)}var ve=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],M=ve.reduce((e,t)=>{const s=ee(`Primitive.${t}`),i=a.forwardRef((r,c)=>{const{asChild:d,...l}=r,p=d?s:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),n.jsx(p,{...l,ref:c})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{}),P="Checkbox",[ge,Pe]=te(P),[be,ye]=ge(P),B=a.forwardRef((e,t)=>{const{__scopeCheckbox:s,name:i,checked:r,defaultChecked:c,required:d,disabled:l,value:p="on",onCheckedChange:u,form:m,...h}=e,[f,x]=a.useState(null),j=I(t,N=>x(N)),g=a.useRef(!1),y=f?m||!!f.closest("form"):!0,[o,v]=fe({prop:r,defaultProp:c??!1,onChange:u,caller:P}),b=a.useRef(o);return a.useEffect(()=>{const N=f==null?void 0:f.form;if(N){const k=()=>v(b.current);return N.addEventListener("reset",k),()=>N.removeEventListener("reset",k)}},[f,v]),n.jsxs(be,{scope:s,state:o,disabled:l,children:[n.jsx(M.button,{type:"button",role:"checkbox","aria-checked":C(o)?"mixed":o,"aria-required":d,"data-state":K(o),"data-disabled":l?"":void 0,disabled:l,value:p,...h,ref:j,onKeyDown:T(e.onKeyDown,N=>{N.key==="Enter"&&N.preventDefault()}),onClick:T(e.onClick,N=>{v(k=>C(k)?!0:!k),y&&(g.current=N.isPropagationStopped(),g.current||N.stopPropagation())})}),y&&n.jsx(q,{control:f,bubbles:!g.current,name:i,value:p,checked:o,required:d,disabled:l,form:m,style:{transform:"translateX(-100%)"},defaultChecked:C(c)?!1:c})]})});B.displayName=P;var $="CheckboxIndicator",W=a.forwardRef((e,t)=>{const{__scopeCheckbox:s,forceMount:i,...r}=e,c=ye($,s);return n.jsx(H,{present:i||C(c.state)||c.state===!0,children:n.jsx(M.span,{"data-state":K(c.state),"data-disabled":c.disabled?"":void 0,...r,ref:t,style:{pointerEvents:"none",...e.style}})})});W.displayName=$;var ke="CheckboxBubbleInput",q=a.forwardRef(({__scopeCheckbox:e,control:t,checked:s,bubbles:i=!0,defaultChecked:r,...c},d)=>{const l=a.useRef(null),p=I(l,d),u=ie(s),m=ne(t);a.useEffect(()=>{const f=l.current;if(!f)return;const x=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(x,"checked").set;if(u!==s&&g){const y=new Event("click",{bubbles:i});f.indeterminate=C(s),g.call(f,C(s)?!1:s),f.dispatchEvent(y)}},[u,s,i]);const h=a.useRef(C(s)?!1:s);return n.jsx(M.input,{type:"checkbox","aria-hidden":!0,defaultChecked:r??h.current,...c,tabIndex:-1,ref:p,style:{...c.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});q.displayName=ke;function C(e){return e==="indeterminate"}function K(e){return C(e)?"indeterminate":e?"checked":"unchecked"}var Ce=B,je=W;function F({className:e,...t}){return n.jsx(Ce,{"data-slot":"checkbox",className:X("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:n.jsx(je,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:n.jsx(ae,{className:"size-3.5"})})})}const Ae=()=>{const{t:e}=Z(),t=G(),[s,i]=a.useState(!1),{notes:r,fetchNotes:c}=se(),[d,l]=a.useState({}),[p,u]=a.useState(!1),m=o=>{l(v=>({...v,[o]:!v[o]}))},h=()=>{const o=r.every(b=>d[b.id]),v={};r.forEach(b=>{v[b.id]=!o}),l(v)},f=()=>r.filter(o=>d[o.id]).length,x=async()=>{try{const o=await U();if(!await re(o))return;i(!0);const b=await c(),N={};b.forEach(k=>{N[k.id]=!0}),l(N)}catch(o){console.error("Failed to load folder:",o)}},j=async()=>{try{u(!0);const o=r.filter(S=>d[S.id]);if(o.length===0){u(!1);return}const v=new ce,b=await U();for(const S of o){const _=await(await b.getFileHandle(S.id)).getFile();_&&v.file(S.id,_)}const N=await v.generateAsync({type:"blob"}),J=`notes_export_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.zip`,O=URL.createObjectURL(N),w=document.createElement("a");w.href=O,w.download=J,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(O)}finally{u(!1)}},g=()=>t("/settings");a.useEffect(()=>{x()},[]);const y=()=>s?r.length===0?n.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:n.jsx("p",{className:"text-slate-500 text-center",children:e("exportNotes.noNotes")})}):n.jsxs("div",{className:"h-[calc(100vh-11rem)]",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx(F,{id:"toggle-select",checked:r.every(o=>d[o.id]),onCheckedChange:h}),n.jsx("label",{className:"text-sm font-medium",htmlFor:"toggle-select",children:r.every(o=>d[o.id])?e("exportNotes.deselectAll"):e("exportNotes.selectAll")})]}),n.jsx("div",{className:"space-y-2 mb-20",children:r.map(o=>n.jsxs("div",{className:"bg-card p-5 rounded-md cursor-pointer transition-colors flex flex-col w-full",onClick:()=>m(o.id),children:[n.jsxs("div",{className:"flex justify-between items-center gap-3",children:[n.jsx(F,{checked:d[o.id],onCheckedChange:()=>m(o.id)}),n.jsx("span",{className:"font-medium mr-auto",children:o.label}),n.jsx("span",{className:"text-xs text-muted-foreground",children:Q(o.updatedAt)})]}),o.isEncrypted||n.jsxs("p",{className:"text-xs text-muted-foreground truncate mt-1",children:[Y(o.content),o.content.length>100?"...":""]}),o.isEncrypted&&n.jsx("p",{className:"text-xs text-muted-foreground mt-1 italic",children:e("exportNotes.encrypted")})]},o.id))})]}):n.jsx("div",{className:"flex flex-col items-center justify-center h-full py-12",children:n.jsx("p",{className:"text-slate-500 text-center",children:e("exportNotes.permissionDenied")})});return n.jsxs("div",{className:"flex flex-col h-full bg-background",children:[n.jsxs("div",{className:"sticky top-0 z-10 border-b px-4 py-3 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(E,{variant:"ghost",size:"icon",onClick:g,className:"mr-2",children:n.jsx(oe,{className:"h-5 w-5"})}),n.jsx("h1",{className:"text-lg font-medium",children:e("exportNotes.title")})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[s||n.jsxs(n.Fragment,{children:[n.jsxs(E,{variant:"outline",size:"sm",onClick:x,className:"hidden sm:flex items-center",children:[n.jsx(D,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:e("exportNotes.buttons.openFolder")})]}),n.jsx(E,{variant:"outline",size:"icon",onClick:x,className:"sm:hidden",children:n.jsx(D,{className:"h-4 w-4"})})]}),n.jsxs(E,{size:"sm",onClick:j,disabled:p||f()===0,className:"hidden sm:flex items-center",children:[n.jsx(L,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:e("exportNotes.buttons.export")})]}),n.jsx(E,{size:"icon",onClick:j,disabled:p||f()===0,className:"sm:hidden",children:n.jsx(L,{className:"h-4 w-4"})})]})]}),n.jsx("div",{className:"flex-1 px-4 py-3 overflow-hidden",children:y()})]})};export{Ae as default};
